def write_image_test_data(d):
    from oe.data import export2json

    testdata = "%s/%s.testdata.json" % (d.getVar('DEPLOY_DIR_IMAGE'), d.getVar('IMAGE_NAME'))
    testdata_link = "%s/%s.testdata.json" % (d.getVar('DEPLOY_DIR_IMAGE'), d.getVar('IMAGE_LINK_NAME'))

    bb.utils.mkdirhier(os.path.dirname(testdata))
    searchString = "%s/"%(d.getVar("TOPDIR")).replace("//","/")
    export2json(d, testdata,searchString=searchString,replaceString="")

    if testdata_link != testdata:
        if os.path.lexists(testdata_link):
           os.remove(testdata_link)
        os.symlink(os.path.basename(testdata), testdata_link)

write_image_test_data(d)

